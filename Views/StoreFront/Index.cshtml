@using Microsoft.AspNetCore.Identity
@model CartDetails
@inject UserManager<User> UserManager
@using ECommerce1.Data.Enums

@{
    ViewData["Title"] = ViewBag.PageTitle;
}

@*Hero Section*@
<section class="py-5 bg-light">
    <div class="container py-4">
        <div class="row">
            <div class="col-lg-9 order-2 order-lg-1">
                <h1>@ViewBag.PageTitle</h1><p class="lead text-muted">@ViewBag.PageDescription</p>
            </div>
            <div class="col-lg-3 text-end order-1 order-lg-2">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb py-4 justify-content-lg-end mb-0">
                        <li class="breadcrumb-item"><a asp-controller="StoreFront" asp-action="Home">Home</a></li>
                        <li class="breadcrumb-item active">@ViewBag.PageTitle</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</section>
@*End Hero Section*@
<main class="py-5">
    <div class="container py-5">
        <div class="row gx-lg-5">
            <div class="col-xl-3 col-lg-4">
                @*Product Categories*@
                <h6 class="text-uppercase mb-4">Product Categories</h6>
                <ul class="list-unstyled">
                    <li class="active">
                        <ul class="list-unstyled ms-4">
                            @foreach (var item in ViewBag.ProductCategories)
                            {
                                <li>
                                    <a class="sidebar-link" href="#">
                                        @item.Title
                                    </a>
                                </li>
                            }
                        </ul>
                    </li>
                </ul>
                <div class="border-bottom my-5"></div>
                @*Price Range*@
                <h6 class="text-uppercase mb-4">Filter By Price</h6>
                <div class="price-range pt-4 mb-5">
                    <div id="priceRange" class="noUi-target noUi-ltr noUi-horizontal noUi-txt-dir-ltr"><div class="noUi-base"><div class="noUi-connects"><div class="noUi-connect" style="transform: translate(9.93007%, 0px) scale(0.214985, 1);"></div></div><div class="noUi-origin" style="transform: translate(-900.699%, 0px); z-index: 5;"><div class="noUi-handle noUi-handle-lower" data-handle="0" tabindex="0" role="slider" aria-orientation="horizontal" aria-valuemin="0.0" aria-valuemax="110.0" aria-valuenow="34.8" aria-valuetext="34.76"><div class="noUi-touch-area"></div><div class="noUi-tooltip">34.76</div></div></div><div class="noUi-origin" style="transform: translate(-685.714%, 0px); z-index: 6;"><div class="noUi-handle noUi-handle-upper" data-handle="1" tabindex="0" role="slider" aria-orientation="horizontal" aria-valuemin="34.8" aria-valuemax="350.0" aria-valuenow="110.0" aria-valuetext="110.00"><div class="noUi-touch-area"></div><div class="noUi-tooltip">110.00</div></div></div></div></div>
                    <div class="row pt-2 mb-3">
                        <div class="col-6"><strong class="small font-weight-bold">From</strong></div>
                        <div class="col-6 text-end"><strong class="small font-weight-bold">To</strong></div>
                    </div><a class="btn btn-dark btn-sm" href="#">filter</a>
                </div>
                <div class="border-bottom my-4"></div>
                @*Brands*@
                <h6 class="text-uppercase mb-4">Show by brand</h6>
                <div class="mb-2 form-check">
                    <input class="form-check-input" id="brand0" type="checkbox" name="clothes-brand" checked="">
                    <label class="form-check-label" for="brand0">Calvin Klein <small class="text-xs text-muted">(18) </small></label>
                </div>
                <div class="mb-2 form-check">
                    <input class="form-check-input" id="brand1" type="checkbox" name="clothes-brand" checked="">
                    <label class="form-check-label" for="brand1">Levi Strauss <small class="text-xs text-muted">(30) </small></label>
                </div>
                <div class="mb-2 form-check">
                    <input class="form-check-input" id="brand2" type="checkbox">
                    <label class="form-check-label" for="brand2">Hugo Boss <small class="text-xs text-muted">(120) </small></label>
                </div>
                <div class="mb-2 form-check">
                    <input class="form-check-input" id="brand3" type="checkbox">
                    <label class="form-check-label" for="brand3">Tomi Hilfiger <small class="text-xs text-muted">(70) </small></label>
                </div>
                <div class="mb-2 form-check">
                    <input class="form-check-input" id="brand4" type="checkbox">
                    <label class="form-check-label" for="brand4">Tom Ford  <small class="text-xs text-muted">(110) </small></label>
                </div>
                <div class="border-bottom my-4"></div>
                @*Sizes*@
                <h6 class="text-uppercase mb-4">Size </h6>
                <form action="#">
                    <div class="form-check mb-1">
                        <input class="form-check-input" id="size0" type="radio" name="size" checked="">
                        <label class="form-check-label" for="size0">Small </label>
                    </div>
                    <div class="form-check mb-1">
                        <input class="form-check-input" id="size1" type="radio" name="size">
                        <label class="form-check-label" for="size1">Medium </label>
                    </div>
                    <div class="form-check mb-1">
                        <input class="form-check-input" id="size2" type="radio" name="size">
                        <label class="form-check-label" for="size2">Large </label>
                    </div>
                    <div class="form-check mb-1">
                        <input class="form-check-input" id="size3" type="radio" name="size">
                        <label class="form-check-label" for="size3">X-Large </label>
                    </div>
                </form>
            </div>
            @*Begin Content*@
            <div class="col-xl-9 col-lg-8">
                @*Filters*@
                <header class="d-flex mb-5">
                    @*Search*@
                    <div class="w-75 mr-5">
                        <input class="form-control" placeholder="Search" type="text">
                    </div>
                    @*Sort By*@
                    <div class="choices" data-type="select-one" tabindex="0" role="listbox" aria-haspopup="true" aria-expanded="false">
                        <div class="choices__inner">
                            <select class="form-control js-sort choices__input" name="sort" hidden="" tabindex="-1" data-choice="active">
                                <option value="">Sort by</option>
                            </select>
                            <div class="choices__list choices__list--single">
                                <div class="choices__item choices__placeholder choices__item--selectable" data-item="" data-id="1" data-value="" data-custom-properties="null" aria-selected="true">Sort by</div>
                            </div>
                        </div>
                    </div>
                </header>
                <div class="row gy-5 mb-5">
                    <span class="visible-items">Showing <strong>1-15 </strong>of <strong>@ViewBag.Products.Count </strong>results</span>

                    @*Products*@

                    @foreach (var item in ViewBag.Products)
                    {
                        <div class="item col-xl-4 col-md-6">
                            <div class="product">
                                <div class="image d-flex align-items-center justify-content-center bg-light">
                                    @{
                                        if (item.IsSale)
                                        {
                                            <div class="ribbon ribbon-primary text-uppercase">Sale</div>
                                        }

                                        if (item.StockStatusId == (int)StockStatusEnum.OutOfStock)
                                        {
                                            <img class="img-fluid" src="@String.Format("data:image/jpg;base64,{0}", item.Image)" alt="@item.Name" style="-webkit-filter: grayscale(100%); filter: grayscale(100%); ">
                                        }
                                        else
                                        {
                                            <img class="img-fluid" src="@String.Format("data:image/jpg;base64,{0}", item.Image)" alt="@item.Name">
                                        }
                                    }
                                    <form asp-controller="Cart" asp-action="AddToCart">
                                        <div class="hover-overlay d-flex align-items-center justify-content-center">
                                            <div class="CTA d-flex align-items-center justify-content-center">
                                                <input type="hidden" asp-for="CustomersId" value="@ViewBag.CustomersId" />
                                                <input type="hidden" asp-for="ProductId" value="@item.Id" />
                                                <input type="hidden" asp-for="Quantity" value="1" />
                                                @{
                                                    var _IsAdmin = false;
                                                    if (UserManager.GetUserAsync(User).Result != null)
                                                    {
                                                        if (UserManager.GetUserAsync(User).Result.IsAdmin != null)
                                                        {
                                                            if ((bool)UserManager.GetUserAsync(User).Result.IsAdmin) _IsAdmin = true;
                                                        }

                                                        if (_IsAdmin == true)
                                                        {
                                                            <a asp-controller="Products" asp-action="UpdateProduct" asp-route-id="@item.Id" style="border: none">
                                                                <i class="far fa-edit"></i>
                                                            </a>
                                                        }
                                                        else
                                                        {
                                                            <button type="submit" class="btn btn-link">
                                                                <i class="fas fa-shopping-cart"></i>
                                                            </button>
                                                        }
                                                    }
                                                }
                                                <button class="btn btn-link active" asp-controller="StoreFront" asp-action="ViewProduct" asp-route-id="@item.Id">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="pt-3">
                                    <small class="text-muted">Clothing</small><a class="reset-anchor" asp-controller="StoreFront" asp-action="ViewProduct" asp-route-id="@item.Id">
                                        <h3 class="h6 mb-0 text-uppercase">@item.Name</h3>
                                    </a>
                                    @{
                                        if (item.IsSale)
                                        {
                                            <span class="text-muted"><del>Php @item.Price</del></span> <span class="text-danger h6">Php @item.PriceOnSale</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">Php @item.Price</span>
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
                @*Pagination*@
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1" aria-disabled="true">Prev</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">4</a></li>
                        <li class="page-item"><a class="page-link" href="#">5</a></li>
                        <li class="page-item"><a class="page-link" href="#">Next</a></li>
                    </ul>
                </nav>
            </div>
            @*End Content*@
        </div>
    </div>
</main>

<div style="position: fixed; bottom: 10px; right: 10px;">
    <button onclick="topFunction()" id="btnTop" value="Back to Top" class="btn btn-outline-danger">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </button>
</div>

<script>
    var btnTop = document.getElementById("btnTop");
    window.onload = function () { btnTop.style.display = "none"; }

    function setProductId(productId) {
        document.getElementById('hidden_product_id').value = document.getElementById(productId).getAttribute('data-subcat');
    }
</script>
